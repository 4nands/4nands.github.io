<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
#d1{width:400px;height:400px;background-color:yellow;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/109/three.min.js"></script>
<script src="TrackballControls.js"></script>
<script>
var canvas,w,h;
var scene,renderer,camera,light;
var trackball;
window.addEventListener('load',init);
var material;
var body=[];
var r=[];
var p=[];
var m=[];
var x=[],y=[],z=[];
var x0=[],y0=[],z0=[];
var vx=[],vy=[],vz=[];
var fx=[],fy=[];fz=[];
var ax=[],ay=[],az=[];
var n=3;
var step=500;
var dt=0.001;
var G=0.01;
function init(){

	canvas=document.getElementById('d1');
	w=canvas.clientWidth;
	h=canvas.clientHeight;
	
	r[0]=7;r[1]=7;r[2]=7;
	p[0]=1;p[1]=1;p[2]=1;	
	
	for(var i=0;i<n;i++){
		m[i]=r[i]*r[i]*r[i]*p[i];
	}

	x[0]=0;y[0]=0;z[0]=0;
	
	vx[0]=0;vy[0]=0;vz[0]=0;
	
	force();
	for(var i=0;i<n;i++){
		x0[i]=x[i]-vx[i]*dt+ax[i]*dt*dt/2;
		y0[i]=y[i]-vy[i]*dt+ay[i]*dt*dt/2;
		z0[i]=z[i]-vz[i]*dt+az[i]*dt*dt/2;

	}

	scene=new THREE.Scene();

	renderer=new THREE.WebGLRenderer({antialias:true});
	renderer.setSize(w,h);
	renderer.setClearColor(0x000000);
	renderer.shadowMap.enabled=true;
	canvas.appendChild(renderer.domElement);

	camera=new THREE.PerspectiveCamera(45,w/h,0.1,1000);
	camera.up.set(0,0,1);
	camera.position.set(50,50,30);
	camera.lookAt(scene.position);

	trackball=new THREE.TrackballControls(camera,canvas);

	var axis=new THREE.AxisHelper(200);
	scene.add(axis);

	light=new THREE.DirectionalLight(0xffffff,1);
	light.position.set(0,0,100);
	light.castShadow=true;
	light.shadow.camera.right=100;
	light.shadow.camera.left=-100;
	light.shadow.camera.top=100;
	light.shadow.camera.bottom=-100;
	scene.add(light);

	material=new THREE.MeshLambertMaterial(0xffffff);
	for(var i=0;i<n;i++){
		body[i]=new THREE.Mesh(new THREE.SphereGeometry(r[i],100,100),material);
		body[i].castShadow=true;
		body[i].receiveShadow=true;
		scene.add(body[i]);
	}

			
	document.getElementById('d2').textContent="ok";

	


	loop();
}
function force(){
	
	for(var i=0;i<n;i++){
	
		fx[i]=0;
		fy[i]=0;
		fz[i]=0;
		
		for(var j=0;j<n;j++){
			
			if(i != j){
				var r2=(x[i]-x[j])*(x[i]-x[j])+(y[i]-y[j])*(y[i]-y[j])+(z[i]-z[j])*(z[i]-z[j])
				var r=Math.sqrt(r2);
				fx[i]-=G*m[i]*m[j]*(x[i]-x[j])/r2/r;
				fy[i]-=G*m[i]*m[j]*(y[i]-y[j])/r2/r;
				fz[i]-=G*m[i]*m[j]*(z[i]-z[j])/r2/r;

			}


		}	


	}

	for(var i=0;i<n;i++){
		ax[i]=fx[i]/m[i];
		ay[i]=fy[i]/m[i];
		az[i]=fz[i]/m[i];
	
	}

}
function loop(){


	for(var k=0;k<step;k++){

	force();

	for(var i=0;i<n;i++){

		var xx,yy,zz;

		xx=x[i];yy=y[i];zz=z[i];

		
		x[i]=x[i]*2-x0[i]+ax[i]*dt*dt;
		y[i]=y[i]*2-y0[i]+ay[i]*dt*dt;
		z[i]=z[i]*2-z0[i]+az[i]*dt*dt;


		
		x0[i]=xx;y0[i]=yy;z0[i]=zz;



		body[i].position.set(x[i],y[i],z[i]);
	}
	}

	for(var i=0;i<n;i++){
		body[i].position.set(x[i],y[i],z[i]);
	}
	

	trackball.update();	
	renderer.render(scene,camera);
	
	requestAnimationFrame(loop);
}
</script>
</head>
<body>
<div id="d1"></div>
<a id="d2"></a>
</body>
</html>